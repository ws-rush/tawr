(function(o,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("valtio"),require("derive-valtio")):typeof define=="function"&&define.amd?define(["exports","valtio","derive-valtio"],i):(o=typeof globalThis<"u"?globalThis:o||self,i(o.TawrState={},o.valtio,o.deriveValtio))})(this,function(o,i,s){"use strict";function b(p){const{state:S,getters:v,actions:y}=p,e=i.proxy(S()),d=new Set;if(v){const r=v(e);s.derive(r,{proxy:e}),e.$underive=n=>{n&&n.length>0?s.underive(e,{keys:n.map(String),delete:!0}):s.underive(e)},e.$invalidate=n=>{if(n&&n.length>0){s.underive(e,{keys:n.map(String),delete:!0});const u={};for(const f of n)u[f]=r[f];s.derive(u,{proxy:e})}else s.underive(e),s.derive(r,{proxy:e})}}if(e.$onAction=r=>(d.add(r),()=>{d.delete(r)}),y){const r={};for(const[n,u]of Object.entries(y)){const f=(...g)=>{let h=[],l=[];const x={name:n,store:e,args:g,after:t=>{h.push(t)},onError:t=>{l.push(t)}};d.forEach(t=>{t(x)});let c;try{return c=u.apply(e,g),c instanceof Promise?c.then(t=>(h.forEach(a=>a(t)),t)).catch(t=>{throw l.forEach(a=>a(t)),t}):(h.forEach(t=>t(c)),c)}catch(t){throw l.forEach(a=>a(t)),t}};r[n]=f}Object.defineProperty(e,"actions",{value:r,enumerable:!0,configurable:!0}),Object.assign(e,r)}return e}const m=p=>i.useSnapshot(p);o.defineStore=b,o.useSnapshot=m,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
